$(function(){applyConfig(loadConfig());$(".sectionNavigation").click(function(g){g.preventDefault();var f=$(this).attr("href");var d=$("#room").val();if(f=="#firstScreen"){document.location.href="/"}else{if(f=="#alertClose"){$(".alert").hide()}else{if(f=="#readerScreenInfo"){$(".readerScreenInfo").show();$("html").addClass("no-scroll")}else{if(f=="#screenFlipHorizontal"){setConfigItem("flipHorizontal",!loadConfig().flipHorizontal)}else{if(f=="#screenFlipVertical"){setConfigItem("flipVertical",!loadConfig().flipVertical)}else{if(f=="#readerScreenInfoClose"){$(".readerScreenInfo").hide();$("html").removeClass("no-scroll")}else{if(f=="#fullscreen"){setConfigItem("fullscreen",!loadConfig().fullscreen)}else{console.log(f+": There was a button that won't work, Report to the developer");alert(f+": Report to developer")}}}}}}}});var b=0;$(document).keydown(function(d){if(!$("#readerScreen").hasClass("hidden")){d.preventDefault();switch(d.which){case 13:a.emit("controlls",{room:c,msg:"alert",msgextra:null});break}}if(!$("#readerScreen").hasClass("hidden")&&$("body").hasClass("readerStyle-One")){d.preventDefault();switch(d.which){case 65:case 81:case 70:case 37:case 38:if(b!="0"){b--}a.emit("controlls",{room:c,msg:"position",msgextra:b});break;case 69:case 68:case 74:case 39:case 40:case 32:if(b!=($(".messagesRead div").length-1)){b++}a.emit("controlls",{room:c,msg:"position",msgextra:b});break;default:return}}else{if(!$("#readerScreen").hasClass("hidden")&&$("body").hasClass("readerStyle-Two")){d.preventDefault();switch(d.which){case 65:case 81:case 70:case 37:case 38:if(b!="0"){b--}a.emit("controlls",{room:c,msg:"position",msgextra:b});break;case 69:case 68:case 74:case 39:case 40:if(b!=($(".messagesRead div").length-1)){b++}a.emit("controlls",{room:c,msg:"position",msgextra:b});break;case 32:readerScrollTop=$(window).scrollTop();a.emit("controlls",{room:c,msg:"positionscrollauto",msgextra:readerScrollTop});default:return}}}});var a=io.connect();var a=io();var c;if(localStorage.config!==null&&localStorage.config!=""){c=loadConfig().room}else{document.location.href="/"}a.on("connect",function(){console.log("writer: "+c);a.emit("room",c)});a.on("chat message",function(d){console.log(d);$(".messagesRead").append("<div><p>"+d+"</p></div>")});a.on("controlls",function(e,d){if(e=="alert"){$(".alert-text").text("There is a problem reported");$(".alert").show()}else{if(e=="position"){$("body").animate({scrollTop:($(".messagesRead").height()/$(".messagesRead div").length)*d},"fast")}else{if(e=="positionscrollauto"){var f=d;if(readerTimerScroll==true){readerTimerScroll=false;readerScrollAutoDown=setInterval(function(){f+=scrollSpeed;if($(window).scrollTop()+$(window).height()>$(document).height()-500){clearInterval(readerScrollAutoDown);$(".alert-text").text("End of cue");$(".alert").show()}$("body").animate({scrollTop:f},700,"linear")},300)}else{if(readerTimerScroll==false){readerTimerScroll=true;clearInterval(readerScrollAutoDown)}}}else{console.log(d+": Unknown error in width controlls, report to developer")}}}});$("#createRoom, #arrow-right").click(function(f){f.preventDefault();var d=$("#room").val();a.emit("room",d);$("#defaultRoomName").val(d);$(".alert-text").text("Room has been created");$(".alert").show()})});function loadConfig(){if(!localStorage.config){document.location.href="/"}return JSON.parse(localStorage.config)}function saveConfig(a){localStorage.config=JSON.stringify(a)}function setConfigItem(b,c){var a=loadConfig();a[b]=c;saveConfig(a);applyConfig(a)}function applyConfig(i){if(i!==null||i!=null){var h=i.fontColor,g=i.backgroundColor,n=i.fontFamily,m=i.readerStyle,l=i.textWeight,k=i.textTransform,j=h+" "+g+" "+n+" "+m+" "+l+" "+k;$("body").removeAttr("class").addClass(j)}$("html").css("transform","scale("+(i.flipHorizontal?-1:1)+", "+(i.flipVertical?-1:1)+")");launchFullscreen(document.documentElement,i.fullscreen)}function getURLQuery(a){var c=window.location.search.substring(1);var d=c.split("&");for(var b=0;b<d.length;b++){var e=d[b].split("=");if(e[0]==a){return e[1]}}return(false)}function launchFullscreen(a,b){if(b==false){$(".fullscreen").addClass("fa-compress").removeClass("fa-expand");if(a.requestFullscreen){a.requestFullscreen()}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen()}else{if(a.webkitRequestFullscreen){a.webkitRequestFullscreen()}else{if(a.msRequestFullscreen){a.msRequestFullscreen()}}}}}else{if(b==true){$(".fullscreen").addClass("fa-expand").removeClass("fa-compress");if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else{if(a.msCancelFullscreen){a.msCancelFullscreen()}}}}}}};